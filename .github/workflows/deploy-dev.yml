name: Deploy to Development

on:
  workflow_dispatch:
    # No inputs needed - the "Use workflow from" dropdown provides branch selection with autocomplete

jobs:
  resolve-ref:
    name: Resolve ref/sha
    runs-on: ubuntu-latest
    outputs:
      ref: ${{ steps.resolve.outputs.ref }}
      sha: ${{ steps.resolve.outputs.sha }}
    steps:
      - name: Resolve target ref and sha
        id: resolve
        uses: actions/github-script@v7
        with:
          script: |
            // Use the branch the workflow was triggered from (the "Use workflow from" selection)
            const ref = context.ref.replace('refs/heads/', '');
            const { data } = await github.rest.repos.getBranch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              branch: ref,
            });
            const sha = data.commit.sha;

            core.setOutput('ref', ref);
            core.setOutput('sha', sha);
            
            console.log(`Will deploy: ${ref} @ ${sha}`);

  deploy:
    name: Deploy to Dev
    runs-on: ubuntu-latest
    needs: resolve-ref
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
        with:
          ref: ${{ needs.resolve-ref.outputs.ref }}

      - name: Simulate deployment
        run: |
          echo "=========================================="
          echo "ðŸš€ DEPLOYING TO DEVELOPMENT"
          echo "=========================================="
          echo "Branch: ${{ needs.resolve-ref.outputs.ref }}"
          echo "Commit: ${{ needs.resolve-ref.outputs.sha }}"
          echo "=========================================="
          echo ""
          echo "âœ… Deployment successful! (simulated)"
